{"mappings":"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","sources":["dublr-ui/dublr-ui.js"],"sourcesContent":["\n// Dublr contract -------------------------------------------------\n\nconst dublrAddr = \"0xa823fe789B32b1566fF6931E6e0d0E8c2C51435B\";    // TODO: This is the Rinkeby test address\n\nconst dublrABI = [\n        \"event ListSell(address indexed seller, uint256 priceETHPerDUBLR_x1e9, uint256 amountDUBLRWEI)\",\n        \"event CancelSell(address indexed seller, uint256 priceETHPerDUBLR_x1e9, uint256 amountDUBLRWEI)\",\n        \"event Buy(address indexed buyer, address indexed seller, uint256 priceETHPerDUBLR_x1e9, uint256 amountBoughtDUBLRWEI,\"\n            + \" uint256 amountRemainingInOrderDUBLRWEI, uint256 amountSentToSellerETHWEI, uint256 amountChargedToBuyerETHWEI)\",\n        \"event Mint(address indexed buyer, uint256 priceETHPerDUBLR_x1e9, uint256 amountSpentETHWEI, uint256 amountMintedDUBLRWEI)\",\n        \"event OutOfGasForBuyingSellOrders(address indexed buyer, uint256 buyOrderRemainingETHWEI, uint256 totBoughtDUBLRWEI)\",\n        \"event RefundChange(address indexed buyer, uint256 refundedETHWEI)\",\n        \"event Unpayable(address indexed seller, uint256 amountETHWEI, bytes data)\",\n        \"function orderBookSize() view returns (uint256 numEntries)\",\n        \"function cheapestSellOrder() view returns (uint256 priceETHPerDUBLR_x1e9, uint256 amountDUBLRWEI)\",\n        \"function mySellOrder() view returns (uint256 priceETHPerDUBLR_x1e9, uint256 amountDUBLRWEI)\",\n        \"function cancelMySellOrder()\",\n        \"function allSellOrders() view returns ((uint256 priceETHPerDUBLR_x1e9, uint256 amountDUBLRWEI)[] memory priceAndAmountOfSellOrders)\",\n        \"function sell(uint256 priceETHPerDUBLR_x1e9, uint256 amountDUBLRWEI)\",\n        \"function buy(uint256 minimumTokensToBuyOrMintDUBLRWEI, bool allowBuying, bool allowMinting) payable\",\n        \"function minSellOrderValueETHWEI() returns (uint256)\",\n        \"function buyingEnabled() returns (bool)\",\n        \"function sellingEnabled() returns (bool)\",\n        \"function mintingEnabled() returns (bool)\",\n        \"function mintPrice() external view returns (uint256 mintPrice)\",\n        \"function balanceOf(address addr) returns (uint256)\",\n];\n\n// URL generated by https://metamask.github.io/metamask-deeplinks\nconst DEEP_LINK_URL = \"https://metamask.app.link/dapp/dublr.github.io/dublr-ui\";\n\n// Formatting functions -------------------------------------------\n\nconst ADDR_REGEXP = /^(0x[a-zA-Z0-9]{3})[a-zA-Z0-9]+([a-zA-Z0-9]{4})$/;\n\n// Return an address in the same format as MetaMask\nfunction formatAddress(addr) {\n    const match = addr.match(ADDR_REGEXP);\n    if (!match) return addr;\n    return `${match[1]}...${match[2]}`;\n}\n\nfunction formatPrice(price_x1e9) {\n    return (price_x1e9 * 1e-9).toFixed(9);\n}\n\nfunction dublrToEthRoundUpClamped(price_x1e9, amtDUBLR, maxAmtETH) {\n    const amtETH = (amtDUBLR.mul(price_x1e9).add(1e9-1)).div(1e9);\n    return amtETH.lt(maxAmtETH) ? amtETH : maxAmtETH;\n}\n\nfunction dublrToEth(price_x1e9, amtDUBLR) {\n    return amtDUBLR.mul(price_x1e9).div(1e9);\n}\n\nfunction ethToDublr(price_x1e9, amtETH) {\n    return amtETH.mul(1e9).div(price_x1e9);\n}\n\nconst dollarRegexp = /[-]?[0-9]*([.][0-9][0-9])?/;\n\nfunction formatDollars(amt) {\n    const matches = amt.match(dollarRegexp);\n    if (!matches) {\n        return undefined;\n    }\n    return matches[0]; // Rounds down to nearest 1c by truncation\n}\n\n// Format to 12 significant figures, but keep all figures before the decimal.\n// (It doesn't follow the strict definition of significant figures, because\n// if the number has more than 12 digits to the left of the decimal point,\n// the least-significant digits of the integer part won't be set to zero,\n// and if the number is positive but less than 1.0, every zero counts as a\n// \"significant figure\", meaning it switches to displaying 11 decimal points\n// regardless of whether they are zeroes or not.\n// Also truncates (rounds down) at the last digit.\n// In other words this is a pretty lazy (utilitarian) number formatter.\nfunction formatSF(num) {\n    const targetSF = 12;\n    let numSF = 0;\n    let hitDot = false;\n    let out = \"\";\n    for (var i = 0; i < num.length; i++) {\n        const c = num.charAt(i);\n        if (c == \".\") {\n            hitDot = true;\n            if (numSF >= targetSF) {\n                break;\n            }\n        } else {\n            if (hitDot && numSF >= targetSF) {\n                break;\n            }\n            if (!isNaN(c)) {\n                // Count all digits on left of decimal\n                numSF++;\n            }\n        }\n        out += c;            \n    }\n    return out;\n}\n\nfunction weiToDisplay(amtWEI, currency, priceUSDPerCurrency) {\n    if (amtWEI === undefined) {\n        return \"(unknown)\";\n    }\n    const amtWEIStr = formatSF(ethers.utils.formatEther(amtWEI));\n    let amtUSDFormatted;\n    if (priceUSDPerCurrency !== undefined) {\n        const price = currency === \"ETH\" ? priceUSDPerCurrency.eth : priceUSDPerCurrency.dublr;\n        if (price !== undefined) {\n            const priceUSDPerCurrency_x1e9 = Math.floor(price * 1e9);\n            const amtUSDWEI = amtWEI.mul(priceUSDPerCurrency_x1e9).div(1e9);\n            const amtUSDStr = formatSF(ethers.utils.formatEther(amtUSDWEI));\n            amtUSDFormatted = formatDollars(amtUSDStr);\n        }\n    }\n    return amtWEIStr + \" \" + currency\n            + (amtUSDFormatted === undefined ? \"\" : \" (~\" + amtUSDFormatted + \" USD)\");\n}\n\nfunction ethToWei(eth) {\n    return ethers.utils.parseEther(eth);\n}\n\nasync function safe(promise) {\n    try {\n        const result = await promise;\n        return result;\n    } catch (e) {\n        console.log(e);\n        return undefined;\n    }\n}\n\nfunction makeSubTable(keys, values) {\n    let html = \"<table class='no-alt-bg' style='margin-left: auto; margin-right: auto;'>\";\n    html += \"<tbody>\";\n    if (keys.length !== values.length) {\n        throw new Error(\"keys.length !== values.length\");\n    }\n    for (var i = 0; i < values.length; i++) {\n        const label = keys[i];\n        const value = values[i];\n        html += \"<tr>\";\n        html += \"<td class='num-label'>\" + keys[i] + \"</td>\";\n        html += \"<td class='num'>\" + values[i] + \"</td>\";\n        html += \"</tr>\";\n    }\n    html += \"</tbody>\";\n    html += \"</table>\";\n    return html;\n}\n\n// Based on https://stackoverflow.com/a/21742107/3950982\nfunction isMobile() {\n    var userAgent = navigator.userAgent || navigator.vendor || window.opera;\n    return /windows phone/i.test(userAgent)\n        || /android/i.test(userAgent)\n        || (/iPad|iPhone|iPod/.test(userAgent) && !window.MSStream);\n}\n\n// Dataflow inputs from Dublr contract ----------------------------------------------\n\nasync function provider(chainId) {\n    if (!chainId) {\n        return undefined;\n    }\n    \n    // Connect Ethers to MetaMask\n    const metaMaskProvider = new ethers.providers.Web3Provider(window.ethereum);\n\n    // Listen to all DUBLR events, and set dublrStateTrigger to the block number of any events\n    // that are emitted. Using the block number as the state trigger will cause only one dataflow\n    // change even if there are many events emitted in a single block.\n    metaMaskProvider.on({ address: dublrAddr }, (log, event) => {\n        // Ignore log entries without block numbers (this includes RPC errors, such as reverted\n        // transactions)\n        if (log?.blockNumber) {\n            dataflow.set({ dublrStateTrigger: log.blockNumber });\n        }\n    });\n    \n    return metaMaskProvider;\n}\n\nasync function dublr(provider, wallet) {\n    if (!provider || !wallet) {\n        dataflow.set({\n            networkInfo_out: \"\",\n            networkInfoIsWarning_out: false,\n            etherscanURL_out: \"https://github.com/dublr/dublr\"\n        });\n        return undefined;\n    }\n    \n    const network = await safe(provider.getNetwork());\n    const networkNameRaw = !network || network.name === \"\" ? \"(Unknown)\"\n        : network.name === \"homestead\" ? \"mainnet\" : network.name;\n    const networkName = networkNameRaw.charAt(0).toUpperCase() + networkNameRaw.slice(1);\n    \n    const contract = new ethers.Contract(dublrAddr, dublrABI, provider);\n    // Check DUBLR contract is deployed on this network\n    const code = await safe(provider.getCode(dublrAddr));\n    if (code && code.length <= 2) {\n        // If code is \"0x\" then there is no contract currently deployed at address\n        dataflow.set({\n            networkInfo_out: \"The Dublr contract is not deployed on \" + networkName,\n            networkInfoIsWarning_out: true,\n            etherscanURL_out: \"https://github.com/dublr/dublr\"\n        });\n        return undefined;\n    } else {\n        const url = networkName === \"(Unknown)\" ? \"\"\n                : networkName === \"Mainnet\" ? \"https://etherscan.io/address/\" + dublrAddr\n                : \"https://\" + networkName.toLowerCase() + \".etherscan.io/address/\" + dublrAddr;\n        dataflow.set({\n            networkInfo_out: \"Blockchain network: <span class='num'>\" + networkName + \"</span>\",\n            networkInfoIsWarning_out: false,\n            etherscanURL_out: url\n        });\n        return contract.connect(provider.getSigner());\n    }\n}\n\nasync function buyingEnabled(dublr, dublrStateTrigger) {\n    return !dublr ? undefined : await safe(dublr.callStatic.buyingEnabled());\n}\n\nasync function sellingEnabled(dublr, dublrStateTrigger) {\n    return !dublr ? undefined : await safe(dublr.callStatic.sellingEnabled());\n}\n\nasync function mintingEnabled(dublr, dublrStateTrigger) {\n    return !dublr ? undefined : await safe(dublr.callStatic.mintingEnabled());\n}\n\nasync function balanceETHWEI(provider, wallet, dublrStateTrigger) {\n    return !provider || !wallet ? undefined : await safe(provider.getBalance(wallet));\n}\n\nasync function balanceDUBLRWEI(dublr, wallet, dublrStateTrigger) {\n    return !dublr || !wallet ? undefined : await safe(dublr.callStatic.balanceOf(wallet));\n}\n\nasync function minSellOrderValueETHWEI(dublr, dublrStateTrigger) {\n    return !dublr ? undefined : await safe(dublr.callStatic.minSellOrderValueETHWEI());\n}\n\n// Timer that fires every 60 seconds to trigger the mint price and ETH price updates\nsetInterval(() => dataflow.set({ priceTimerTrigger: Date.now() }), 60 * 1000);\n\n// Update mint price every 60 seconds\nasync function mintPriceETHPerDUBLR_x1e9(dublr, dublrStateTrigger, priceTimerTrigger) {\n    if (!dublr) {\n        dataflow.set({mintPrice_out: \"(unknown)\"});  // Pushed to UI\n        return undefined;        \n    } else {\n        const mintPrice_x1e9 = await safe(dublr.callStatic.mintPrice());\n        if (mintPrice_x1e9 === undefined) {\n            dataflow.set({mintPrice_out: \"(unknown)\"});\n            return undefined;\n        }\n        dataflow.set({ mintPrice_out: formatPrice(mintPrice_x1e9) + \" ETH per DUBLR\"});  // Pushed to UI\n        return mintPrice_x1e9;\n    }\n}\n\n// From https://dmitripavlutin.com/timeout-fetch-request/\nasync function fetchWithTimeout(resource, options = {}) {\n  const { timeout = 8000 } = options;\n  \n  const controller = new AbortController();\n  const id = setTimeout(() => controller.abort(), timeout);\n  const response = await fetch(resource, {\n    ...options,\n    signal: controller.signal  \n  });\n  clearTimeout(id);\n  return response;\n}\n\n// Update price of USD per ETH and USD per DUBLR every 60 seconds\nasync function priceUSDPerCurrency(priceTimerTrigger) {\n    var price = {};\n    try {\n        const response = await fetchWithTimeout(\n                \"https://api.coingecko.com/api/v3/simple/price?ids=ethereum,dublr&vs_currencies=usd\",\n                { timeout: 3000 });\n        const json = await response.json();\n        const parsedEthPrice = Number.parseFloat(json?.ethereum?.usd);\n        price.eth = isNaN(parsedEthPrice) ? undefined : parsedEthPrice;\n        const parsedDublrPrice = Number.parseFloat(json?.dublr?.usd);\n        price.dublr = isNaN(parsedDublrPrice) ? undefined : parsedDublrPrice;\n    } catch (e) {\n        const err = e.message === \"The user aborted a request.\" ? \"CoinGecko API timeout\" : e;\n        console.log(\"Could not fetch ETH price:\", err);\n    }\n    return price;\n}\n\nasync function orderBook(dublr, mySellOrder, mintPriceETHPerDUBLR_x1e9, priceUSDPerCurrency, dublrStateTrigger) {\n    if (!dublr) {\n        dataflow.set({\n            orderbookTable_out: \"\",\n            orderBookNote_out: \"(No Dublr contract on this network)\"\n        });\n        return undefined;\n    }\n    \n    // Get and sort orderbook entries\n    let orderBookEntries = await safe(dublr.callStatic.allSellOrders());\n    if (orderBookEntries === undefined) {\n        dataflow.set({\n            orderbookTable_out: \"\",\n            orderBookNote_out: \"(Could not read orderbook)\"\n        });\n        return undefined;\n    } else if (orderBookEntries.length === 0) {\n        dataflow.set({\n            orderbookTable_out: \"\",\n            orderBookNote_out: \"(Orderbook is empty)\"\n        });\n        return [];\n    }\n    \n    // TODO: check sorting works in increasing order of price\n    orderBookEntries.sort((a, b) => a.priceETHPerDUBLR_x1e9.lt(b.priceETHPerDUBLR_x1e9) ? -1 : 1);\n\n    // Update UI with orderbook entries\n    let tableRows = \"\";    \n    let note = \"\";\n    let cumulAmtETHWEI = ethers.BigNumber.from(0);\n    let matchedMySellOrder = false;\n    for (var idx = 0; idx < orderBookEntries.length; idx++) {\n        var sellOrder = orderBookEntries[idx];\n        // Check if order matches the wallet's own sell order\n        const sellOrderMatches = mySellOrder !== undefined\n                && mySellOrder.priceETHPerDUBLR_x1e9.eq(sellOrder.priceETHPerDUBLR_x1e9)\n                && mySellOrder.amountDUBLRWEI.eq(sellOrder.amountDUBLRWEI);\n        const isMySellOrder = sellOrderMatches && !matchedMySellOrder;\n        if (isMySellOrder) {\n            matchedMySellOrder = true;\n            note = \"‚û°Ô∏è : Your active sell order\";\n        }\n        const aboveMintPrice = mintPriceETHPerDUBLR_x1e9 !== undefined\n                && sellOrder.priceETHPerDUBLR_x1e9.gt(mintPriceETHPerDUBLR_x1e9);\n        if (aboveMintPrice) {\n            note += (note.length === 0 ? \"\" : \"<br/>\")\n                + \"üî∫ : Sell order is priced above mint price (can't be bought yet)\";\n        }\n        const amtETHWEI = dublrToEth(sellOrder.priceETHPerDUBLR_x1e9, sellOrder.amountDUBLRWEI);\n        cumulAmtETHWEI = cumulAmtETHWEI.add(amtETHWEI);\n        tableRows +=\n            // Set font-family so that the emoji isn't monochrome\n            \"<tr><td style='border-right: 1px solid silver;'>\"\n            + \"<span style='font-family: \\\"Maven Pro\\\";'>\"\n            + (isMySellOrder ? \"‚û°Ô∏è<br/>\" : \"\") + (aboveMintPrice ? \"üî∫<br/>\" : \"\") + \"</span>#\"\n            + (idx + 1) + \":</td><td>\" + makeSubTable(\n                [\"Price (ETH per DUBLR):\", \"Amount (DUBLR):\", \"Value (ETH):\", \"Cumul Value (ETH):\"],\n                [\n                    formatPrice(sellOrder.priceETHPerDUBLR_x1e9),\n                    weiToDisplay(sellOrder.amountDUBLRWEI, \"DUBLR\", priceUSDPerCurrency),\n                    weiToDisplay(amtETHWEI, \"ETH\", priceUSDPerCurrency),\n                    weiToDisplay(cumulAmtETHWEI, \"ETH\", priceUSDPerCurrency)\n                ]\n        ) + \"</td></tr>\";\n    }\n    // TODO:\n    const tableHTML =\n        \"<table style='margin-left: auto; margin-right: auto; \"\n        + \"border-collapse: separate; border-spacing: 0 .5em;'>\"\n        + \"<tbody>\" + tableRows + \"</tbody></table>\";\n    dataflow.set({ orderbookTable_out: tableHTML, orderBookNote_out: note });\n\n    return orderBookEntries;\n}\n\nasync function mySellOrder(dublr, priceUSDPerCurrency, dublrStateTrigger) {\n    if (!dublr) {\n        dataflow.set({ mySellOrderTable_out: \"\", noSellOrderListed_out: \"(None)\", cancelSellViz_out: \"none\" });\n        return undefined;\n    }\n    const sellOrder = await safe(dublr.callStatic.mySellOrder());\n    if (sellOrder && !sellOrder.priceETHPerDUBLR_x1e9.isZero() && !sellOrder.amountDUBLRWEI.isZero()) {\n        const amtETHWEI = dublrToEth(sellOrder.priceETHPerDUBLR_x1e9, sellOrder.amountDUBLRWEI);\n        const amtLessFeeETHWEI = amtETHWEI.mul(9985).div(10000);  // Subtract 0.15% fee\n        const tableHTML = makeSubTable(\n            [\"Price (ETH per DUBLR):\", \"Amount (DUBLR):\", \"Value (ETH):\", \"Value after fee (ETH):\"],\n            [\n                formatPrice(sellOrder.priceETHPerDUBLR_x1e9),\n                weiToDisplay(sellOrder.amountDUBLRWEI, \"DUBLR\", priceUSDPerCurrency),\n                weiToDisplay(amtETHWEI, \"ETH\", priceUSDPerCurrency),\n                weiToDisplay(amtLessFeeETHWEI, \"ETH\", priceUSDPerCurrency)\n            ]\n        );\n        dataflow.set({ mySellOrderTable_out: tableHTML, noSellOrderListed_out: \"\", cancelSellViz_out: \"block\" });\n        return sellOrder;\n    }\n}\n\nasync function minSellOrderValueETHWEI(dublr, priceUSDPerCurrency, dublrStateTrigger) {\n    if (!dublr) {\n        dataflow.set({ minSellOrderValue_out: \"(unknown)\" });\n         return undefined;\n    }\n    const val = await safe(dublr.callStatic.minSellOrderValueETHWEI());\n    dataflow.set({\n        minSellOrderValue_out: val === undefined ? \"(unknown)\"\n            : weiToDisplay(val, \"ETH\", priceUSDPerCurrency)\n    });\n    return val;\n}\n\nasync function gasFeeDataETHWEI(provider, dublrStateTrigger) {\n    return !provider ? undefined : await safe(provider.getFeeData());\n}\n\n// Validation functions for dataflow input from DOM -----------------------------\n\nlet oldAllowBuying = true;\nlet oldAllowMinting = true;\n\n// Force at least one of the buy or mint checkboxes to be checked\nasync function constrainBuyMintCheckboxes(allowBuying, allowMinting) {\n    let ab = allowBuying === undefined ? true : allowBuying;\n    let am = allowMinting === undefined ? true : allowMinting;\n    if (ab === false && am === false) {\n        ab = !oldAllowBuying;\n        am = !oldAllowMinting;\n    }\n    // Push outputs (this also potentially triggers the checkboxes to update, forcing at least one on)\n    dataflow.set({ allowBuying: ab, allowMinting: am });\n    oldAllowBuying = ab;\n    oldAllowMinting = am;\n}\n\nasync function buyAmountETHWEI(buyAmount_in, minSellOrderValueETHWEI, balanceETHWEI, priceUSDPerCurrency) {\n    let warningText = \"\";\n    let amountETHWEI;\n    if (buyAmount_in !== undefined) {\n        try {\n            amountETHWEI = ethToWei(buyAmount_in);\n        } catch (e) {\n            warningText = \"Not a number\";\n        }\n        if (amountETHWEI !== undefined) {\n            if (!amountETHWEI.gt(0)) {\n                warningText = \"Amount must be greater than zero\";\n                amountETHWEI = undefined;\n            } else if (balanceETHWEI === undefined) {\n                // Only output amount if ETH balance of wallet is known, since the amount\n                // has to be smaller than the balance. But still clear the warning text.\n                amountETHWEI = undefined;\n            } else if (!amountETHWEI.lt(balanceETHWEI)) {\n                warningText = \"Amount must be less than wallet ETH balance\";\n                // The amount specified is unusable, so don't propagate it\n                amountETHWEI = undefined;\n            } else if (minSellOrderValueETHWEI !== undefined && amountETHWEI.lt(minSellOrderValueETHWEI)) {\n                warningText = \"You may buy this amount; however, since this is less than the minimum sell order value of \"\n                    + weiToDisplay(minSellOrderValueETHWEI, \"ETH\", priceUSDPerCurrency)\n                    + \", then you will not be able to sell these tokens on the Dublr DEX, unless you sell for a high\"\n                    + \" enough price or buy more. You may or may not be able to sell smaller orders elsewhere.\";\n            }\n        }\n    }\n    // Update UI\n    dataflow.set({buyAmountWarning_out: warningText});\n    return amountETHWEI;\n}\n\n// Gas estimation and simulation of buy -----------------------------------\n\nasync function gasEstETHWEI(provider, dublr, gasFeeDataETHWEI, buyAmountETHWEI, balanceETHWEI,\n        allowBuying, allowMinting, priceTimerTrigger) {\n    if (!provider || !dublr || !buyAmountETHWEI || allowBuying === undefined || allowMinting === undefined\n            || !gasFeeDataETHWEI || !balanceETHWEI) {\n        dataflow.set({ gasEstWarning_out: \"\" });\n        return undefined;\n    }\n    const blockNumber = await safe(provider.getBlockNumber());\n    const block = !blockNumber ? undefined : await safe(provider.getBlock(blockNumber));\n    if (!block) {\n        return undefined;\n    }\n    const gasLimit = block.gasLimit;\n    let gasEstETHWEI;\n    let gasEstETH;\n    let warningText = \"\";\n    try {\n        const gasEstRaw = await dublr.estimateGas.buy(\n                0, // Allow any amount of slippage\n                allowBuying, allowMinting,\n                // Simulate sending the specified amount of ETH, with gas limit set to prev block gas limit\n                {value: buyAmountETHWEI, gasLimit: gasLimit});\n        // Get gas price -- options: gasPrice, maxFeePerGas, maxPriorityFeePerGas\n        const gasPriceETHWEI = gasFeeDataETHWEI.maxFeePerGas;\n        // Calculate gas expenditure by multiplying by gas price\n        gasEstETHWEI = gasEstRaw.mul(gasPriceETHWEI);\n        // Warn if ETH amount plus estimated gas is less than ETH balance\n        if (buyAmountETHWEI !== undefined && balanceETHWEI !== undefined\n                && !gasEstETHWEI.add(buyAmountETHWEI).lt(balanceETHWEI)) {\n            warningText = \"Insufficient ETH balance for amount to spend plus estimated gas\";\n        }\n    } catch (e) {\n        const reason = e.reason ? e.reason : e?.message ? e.message\n                : e.error?.message ? e.error.message : \"unknown reason\";\n        if (reason.includes(\"insufficient funds\")) {\n            warningText = \"Insufficient ETH balance for amount to spend plus estimated gas\";\n        } else if (reason.includes(\"out of gas\")) {\n            warningText = \"Hit max gas limit, try buying a smaller amount\";\n        } else if (reason.includes(\"execution reverted\")) {\n            warningText = reason;\n        } else {\n            console.log(\"Could not estimate gas\", e);\n            warningText = \"Could not estimate gas: \" + reason;\n        }\n    }\n\n    dataflow.set({ gasEstWarning_out: warningText });\n    return gasEstETHWEI;\n}\n\nasync function maxSlippageFrac(maxSlippage_in) {\n    let slippageWarningText = \"\";\n    let slippageFrac;\n    if (maxSlippage_in !== undefined) {\n        const maxSlippagePercent = Number(maxSlippage_in);\n        if (maxSlippage_in === \"\" || isNaN(maxSlippagePercent)) {\n            slippageWarningText = \"Not a number\";\n        } else if (maxSlippagePercent < 0 || maxSlippagePercent > 100) {\n            slippageWarningText = \"Invalid percentage\";\n        } else if (amountBoughtEstDUBLRWEI !== undefined) {\n            slippageFrac = 1e4 * (100 - maxSlippagePercent); // Percentage times 1e6 fixed point base\n        }\n    }\n    dataflow.set({ slippageLimitWarning_out: slippageWarningText });\n    return slippageFrac;\n}\n\nasync function amountBoughtEstDUBLRWEI(balanceETHWEI, buyAmountETHWEI, allowBuying, allowMinting,\n        buyingEnabled, mintingEnabled, orderBook, mySellOrder, maxSlippageFrac,\n        mintPriceETHPerDUBLR_x1e9, gasEstETHWEI, priceUSDPerCurrency) {\n    if (balanceETHWEI === undefined || buyAmountETHWEI === undefined\n            || allowBuying === undefined || allowMinting === undefined\n            || orderBook === undefined || mintPriceETHPerDUBLR_x1e9 === undefined\n            || maxSlippageFrac === undefined) {\n        dataflow.set({\n            executionPlan_out: \"\",\n            minimumTokensToBuyOrMintDUBLRWEI: undefined,\n        });\n        return undefined;\n    }\n    let result = \"<b>Simulating buy function using current orderbook:</b><br/>\"\n    result += \"<ul style='margin-top: 8px; margin-bottom: 8px;'>\";\n    if (orderBook.length == 0) {\n        result += \"<li>Orderbook is empty</li>\";\n    }\n    if (allowMinting && mintPriceETHPerDUBLR_x1e9.eq(0)) {\n        result += \"<li>Minting period has ended; minting is no longer available</li>\";\n    }\n    if (allowBuying && !buyingEnabled) {\n        result += \"<li>Buying of sell orders is currently disabled</li>\";\n    }\n    if (!allowBuying && buyingEnabled) {\n        result += \"<li>You disallowed buying</li>\";\n    }\n    if (allowMinting && !mintingEnabled) {\n        result += \"<li>Minting of new tokens is currently disabled</li>\";\n    }\n    if (!allowMinting && mintingEnabled) {\n        result += \"<li>You disallowed minting</li>\";\n    }\n    // The following is the _buy_stateUpdater method from Dublr.sol, rewritten in JS but without gas checks\n    // or seller payment logic. This had to be ported because estimateGas can't return any contract state.\n    let buyOrderRemainingETHWEI = buyAmountETHWEI;\n    const zero = ethers.BigNumber.from(0);\n    let totBoughtOrMintedDUBLRWEI = zero;\n    let totSpentETHWEI = zero;\n    const orderBookCopy = orderBook.map(\n            (order) => ({priceETHPerDUBLR_x1e9: order.priceETHPerDUBLR_x1e9, amountDUBLRWEI: order.amountDUBLRWEI}));\n    let ownSellOrder;\n    let skipMinting = false;\n    let skippedBuying = true;\n    let tableRows = \"\";\n    let numBought = 0;\n    while (buyingEnabled && allowBuying && buyOrderRemainingETHWEI.gt(0) && orderBookCopy.length > 0) {\n        skippedBuying = false;\n        const sellOrder = orderBookCopy[0];\n        if (mySellOrder !== undefined && ownSellOrder === undefined\n                && mySellOrder.priceETHPerDUBLR_x1e9.eq(sellOrder.priceETHPerDUBLR_x1e9)\n                && mySellOrder.amountDUBLRWEI.eq(sellOrder.amountDUBLRWEI)) {\n            ownSellOrder = sellOrder;\n            orderBookCopy.shift();\n            result += \"<li>Skipping own sell order</li>\";\n            continue;\n        }\n        if (mintPriceETHPerDUBLR_x1e9.gt(0)\n                && sellOrder.priceETHPerDUBLR_x1e9.gt(mintPriceETHPerDUBLR_x1e9)) {\n            break;\n        }\n        const amountBuyerCanAffordAtSellOrderPrice_asDUBLRWEI =\n                ethToDublr(sellOrder.priceETHPerDUBLR_x1e9, buyOrderRemainingETHWEI);\n        if (amountBuyerCanAffordAtSellOrderPrice_asDUBLRWEI.isZero()) {\n            skipMinting = true;\n            break;\n        }\n        const amountToBuyDUBLRWEI = sellOrder.amountDUBLRWEI.lt(amountBuyerCanAffordAtSellOrderPrice_asDUBLRWEI)\n                ? sellOrder.amountDUBLRWEI : amountBuyerCanAffordAtSellOrderPrice_asDUBLRWEI;\n        const amountToChargeBuyerETHWEI = dublrToEthRoundUpClamped(\n                sellOrder.priceETHPerDUBLR_x1e9, amountToBuyDUBLRWEI, buyOrderRemainingETHWEI);\n        orderBookCopy[0].amountDUBLRWEI = orderBookCopy[0].amountDUBLRWEI.sub(amountToBuyDUBLRWEI);\n        const sellOrderRemainingDUBLRWEI = orderBookCopy[0].amountDUBLRWEI;\n        if (sellOrderRemainingDUBLRWEI.isZero()) {\n            orderBookCopy.shift();\n        }\n        totBoughtOrMintedDUBLRWEI = totBoughtOrMintedDUBLRWEI.add(amountToBuyDUBLRWEI);\n        buyOrderRemainingETHWEI = buyOrderRemainingETHWEI.sub(amountToChargeBuyerETHWEI);\n        totSpentETHWEI = totSpentETHWEI.add(amountToChargeBuyerETHWEI);\n        numBought++;\n        tableRows += \"<tr><td>\"\n            + makeSubTable([\"Buy:\", \"at price:\", \"for cost:\"],\n                [\n                    weiToDisplay(amountToBuyDUBLRWEI, \"DUBLR\", priceUSDPerCurrency),\n                    formatPrice(sellOrder.priceETHPerDUBLR_x1e9) + \" ETH per DUBLR\",\n                    weiToDisplay(amountToChargeBuyerETHWEI, \"ETH\", priceUSDPerCurrency)\n                ]) + \"</td></tr>\";\n    }\n    if (mintingEnabled && allowMinting && !skipMinting\n            && mintPriceETHPerDUBLR_x1e9.gt(0) && buyOrderRemainingETHWEI.gt(0)) {\n        const amountToMintDUBLRWEI = ethToDublr(mintPriceETHPerDUBLR_x1e9, buyOrderRemainingETHWEI);\n        const amountToMintETHWEI = dublrToEthRoundUpClamped(\n                mintPriceETHPerDUBLR_x1e9, amountToMintDUBLRWEI, buyOrderRemainingETHWEI);\n        if (amountToMintDUBLRWEI > 0) {\n            totBoughtOrMintedDUBLRWEI = totBoughtOrMintedDUBLRWEI.add(amountToMintDUBLRWEI);\n            buyOrderRemainingETHWEI = buyOrderRemainingETHWEI.sub(amountToMintETHWEI);\n            totSpentETHWEI = totSpentETHWEI.add(amountToMintETHWEI);\n            if (!skippedBuying) {\n                result += \"<li>Ran out of sell orders after buying \" + numBought + \" order\"\n                    + (numBought === 1 ? \"\" : \"s\") + \"; switched to minting</li>\";\n            }\n            tableRows += \"<tr><td>\"\n                + makeSubTable([\"Mint:\", \"at price:\", \"for cost:\"],\n                    [\n                        weiToDisplay(amountToMintDUBLRWEI, \"DUBLR\", priceUSDPerCurrency),\n                        formatPrice(mintPriceETHPerDUBLR_x1e9) + \" ETH per DUBLR\",\n                        weiToDisplay(amountToMintETHWEI, \"ETH\", priceUSDPerCurrency)\n                    ]) + \"</td></tr>\";\n        }\n    }\n    if (tableRows.length > 0) {\n        result += \"<li>Steps completed:</li>\";\n    } else {\n        result += \"<li><span class='warning-text-large'>Nothing can be bought</span></li>\";\n    }\n    result += \"</ul>\";\n    if (tableRows.length > 0) {\n        result += \"<table style='margin-left: auto; margin-right: auto; margin-top: 0; \"\n            + \"border-collapse: separate; border-spacing: 0 .5em;'>\"\n            + \"<tbody>\" + tableRows + \"</tbody></table>\";\n    }\n    result += \"</ul>\";\n    result += \"<div style='margin-top: 12px; margin-bottom: 8px;'><b>Result:</b></div>\";\n    let summaryLabels = [];\n    let summaryValues = [];\n    const totalToSpendETHWEI = buyAmountETHWEI.sub(buyOrderRemainingETHWEI);\n    summaryLabels.push(\"Total to spend:\");\n    summaryValues.push(weiToDisplay(totalToSpendETHWEI, \"ETH\", priceUSDPerCurrency));\n    if (buyOrderRemainingETHWEI > 0) {\n        summaryLabels.push(\"Refunded change:\");\n        summaryValues.push(weiToDisplay(buyOrderRemainingETHWEI, \"ETH\", priceUSDPerCurrency));\n    }\n    summaryLabels.push(\"Total to receive:\");\n    summaryValues.push(weiToDisplay(totBoughtOrMintedDUBLRWEI, \"DUBLR\", priceUSDPerCurrency));\n    let minimumTokensToBuyOrMintDUBLRWEI = totBoughtOrMintedDUBLRWEI.mul(Math.floor(maxSlippageFrac)).div(1e6);\n    summaryLabels.push(\"Min w/ slippage:\");\n    summaryValues.push(weiToDisplay(minimumTokensToBuyOrMintDUBLRWEI, \"DUBLR\", priceUSDPerCurrency));\n    if (gasEstETHWEI !== undefined) {\n        summaryLabels.push(\"Gas estimate:\");\n        summaryValues.push(weiToDisplay(gasEstETHWEI, \"ETH\", priceUSDPerCurrency));\n    }\n\n    result += makeSubTable(summaryLabels, summaryValues);\n    \n    dataflow.set({\n        executionPlan_out: result,\n        minimumTokensToBuyOrMintDUBLRWEI: minimumTokensToBuyOrMintDUBLRWEI,\n    });\n    return totBoughtOrMintedDUBLRWEI;\n}\n\n// UI update functions ----------------------------------------------------\n\nasync function updateWalletUI(provider, wallet, balanceETHWEI, balanceDUBLRWEI, priceUSDPerCurrency) {\n    dataflow.set({\n        walletInfo_out: !wallet ? \"\" : \n        \"Wallet <span class='num'>\" + formatAddress(wallet) + \"</span> balances:<br/>\"\n            + \"<span class='num'>\" + weiToDisplay(balanceETHWEI, \"ETH\", priceUSDPerCurrency) + \"</span><br/>\"\n            + \"<span class='num'>\" + weiToDisplay(balanceDUBLRWEI, \"DUBLR\", priceUSDPerCurrency) + \"</span><br/>\"\n            + \"</span>\"\n    });\n}\n\nasync function buyButtonParams(dublr, buyAmountETHWEI, minimumTokensToBuyOrMintDUBLRWEI,\n        amountBoughtEstDUBLRWEI, allowBuying, allowMinting, gasEstWarning_out, termsBuy_in) {\n    const disabled = !dublr\n        // Double-check that the ETH amount is nonzero\n        || !buyAmountETHWEI || buyAmountETHWEI.eq(0)\n        // Require that the buy simulation was able to buy a nonzero amount of DUBLR\n        || !amountBoughtEstDUBLRWEI || amountBoughtEstDUBLRWEI.eq(0) || !minimumTokensToBuyOrMintDUBLRWEI\n        // One of allowBuying or allowMinting must be checked\n        || allowBuying === undefined || allowMinting === undefined || (!allowBuying && !allowMinting)\n        // Don't allow buying if there's a gas estimation warning showing\n        || gasEstWarning_out\n        // Terms must be agreed to\n        || !termsBuy_in;\n    document.getElementById(\"buyButton\").disabled = disabled;\n    return disabled ? undefined : {\n        // Group all dependencies together in a single object, so that they can be accessed\n        // atomically by the buy button's onclick handler\n        dublr: dublr, buyAmountETHWEI: buyAmountETHWEI,\n        minimumTokensToBuyOrMintDUBLRWEI: minimumTokensToBuyOrMintDUBLRWEI,\n        allowBuying: allowBuying, allowMinting: allowMinting\n    };\n}\n\n// DOMContentLoaded handler ---------------------------------------------------\n\nwindow.addEventListener(\"DOMContentLoaded\", async () => {\n    \n    // Register dataflow functions -------------------------------------------\n    \n    // DEBUG_DATAFLOW = true;\n\n    dataflow.register(\n        constrainBuyMintCheckboxes, buyAmountETHWEI,\n        provider, dublr, balanceETHWEI, balanceDUBLRWEI,\n        mintPriceETHPerDUBLR_x1e9, priceUSDPerCurrency,\n        buyingEnabled, sellingEnabled, mintingEnabled,\n        orderBook, mySellOrder, minSellOrderValueETHWEI,\n        gasFeeDataETHWEI, maxSlippageFrac,\n        gasEstETHWEI, amountBoughtEstDUBLRWEI,\n        updateWalletUI, buyButtonParams,\n    );\n\n    // Seed the dataflow graph with initial price estimates\n    dataflow.set({ priceTimerTrigger: 0 });\n    \n    // Register all reactive elements to set the corresponding input in the dataflow graph based on id.\n    // Seeds the dataflow graph with the initial values of input elements in the UI.\n    dataflow.connectToDOM();\n\n    // Hook up action buttons ----------------------------------------------------------\n    \n    document.getElementById(\"buyButton\").onclick = async (event) => {\n        event.preventDefault();\n        await dataflow.set({});  // Wait for dataflow to end, so that buyButtonParams is most recent version\n        const buyParams = dataflow.value.buyButtonParams;\n        if (buyParams) {\n            // This can take a while to run, since calling a contract via MetaMask requires user interaction.\n            // Launch this in a new Promise, and don't wait for the result, so that dataflow is not held up.\n            new Promise(async () => {\n                try {\n                    dataflow.set({\n                        buyStatus_out: \"\",\n                        buyStatusIsWarning_out: false\n                    });\n                    // Call the Dublr `buy` function\n                    await buyParams.dublr.buy(\n                            buyParams.minimumTokensToBuyOrMintDUBLRWEI,\n                            buyParams.allowBuying, buyParams.allowMinting,\n                            // Don't provide a gas limit, because MetaMask ignores it anyway\n                            // and calculates gas itself\n                            { value: buyParams.buyAmountETHWEI }\n                    );\n                    dataflow.set({\n                        buyStatus_out: \"Transaction submitted successfully\",\n                        buyStatusIsWarning_out: false\n                    });\n                } catch (e) {\n                    let warningText = \"\";\n                    const reason = e.reason ? e.reason : e?.message ? e.message\n                            : e.error?.message ? e.error.message : \"unknown reason\";\n                    if (reason.includes(\"insufficient funds\")) {\n                        warningText = \"Insufficient ETH balance for amount to spend plus gas\";\n                    } else if (reason.includes(\"out of gas\")) {\n                        warningText = \"Ran out of gas, try buying a smaller amount\";\n                    } else if (reason.includes(\"execution reverted\")) {\n                        warningText = reason;\n                    } else if (reason.includes(\"User denied transaction\")) {\n                        warningText = \"Transaction rejected by user\";\n                    } else {\n                        console.log(e);\n                        warningText = \"Could not buy tokens: \" + reason;\n                    }\n                    dataflow.set({\n                        buyStatus_out: \"Previous result: \" + warningText,\n                        buyStatusIsWarning_out: true\n                    });\n                }\n            });\n        }\n    };\n\n    \n    document.getElementById(\"cancelSellOrderButton\").onclick = async (event) => {\n        event.preventDefault();\n        await dataflow.set({});\n    }\n\n    // MetaMask onboarding / connection with wallet -----------------------------------\n    \n    // Push wallet changes and chainId changes into the dataflow graph\n    // (this allows the UI to work with account changes and chainId changes without reloading)\n    const setAccounts = async (accounts) => {\n        dataflow.set({ wallet: accounts?.length > 0 ? accounts[0] : undefined });\n    };\n    const setChainId = async (chainId) => {\n        dataflow.set({ chainId: chainId });\n    };\n    \n    // Onboarding flow (modified from docs)\n    const onboarding = new MetaMaskOnboarding();\n    const onboardButton = document.getElementById(\"onboard\");\n    const onboardText = document.getElementById(\"onboard-text\");\n    let notOriginallyInstalled = false;\n    let listenersAdded = false;\n    const updateButton = async () => {\n        if (!MetaMaskOnboarding.isMetaMaskInstalled()) {\n            notOriginallyInstalled = true;\n            if (isMobile()) {\n                // Mobile onboarding\n                onboardText.innerText = \"Open in MetaMask Browser\";\n                onboardButton.onclick = () => window.location.href = DEEP_LINK_URL;\n            } else {\n                // Desktop onboarding\n                onboardText.innerText = \"Tap here to install MetaMask\";\n                onboardButton.onclick = () => {\n                    onboardText.innerText = \"Waiting for MetaMask to be installed\";\n                    onboardButton.disabled = true;\n                    onboarding.startOnboarding();\n                };\n            }\n        } else {\n            if (!listenersAdded) {\n                // Add account change listeners only once\n                window.ethereum.on(\"accountsChanged\", async (accounts) => {\n                    setAccounts(accounts);\n                    await updateButton();\n                });\n                window.ethereum.on(\"chainChanged\", async (chainId) => {\n                    setChainId(chainId);\n                    await updateButton();\n                });\n                window.ethereum.on(\"disconnect\", (error) => {\n                    // https://docs.metamask.io/guide/ethereum-provider.html#events\n                    // \"In general, this will only happen due to network connectivity issues\n                    // or some unforeseen error.\" (Just log and ignore this.)\n                    console.log(\"MetaMask disconnected\", error);\n                });\n                listenersAdded = true;\n            }\n            // Test if connected without actually requesting accounts --\n            // eth_accounts does not pop up MetaMask UI\n            const accounts = await window.ethereum.request({method: \"eth_accounts\"});\n            setAccounts(accounts);\n            if (accounts?.length > 0) {\n                onboardText.innerText = \"Connected to MetaMask wallet\";\n                onboardButton.disabled = true;\n                onboarding.stopOnboarding();\n                \n                const metaMaskProvider = new ethers.providers.Web3Provider(window.ethereum);\n                dataflow.set({chainId: (await metaMaskProvider.getNetwork()).chainId});\n                \n                if (notOriginallyInstalled) {\n                    // Only try adding token if MetaMask was not originally installed\n                    // (i.e. MetaMask installation will serve as a proxy for determining whether DUBLR\n                    // token was already added to wallet)\n                    try {\n                        if (await window.ethereum.request({\n                            method: \"wallet_watchAsset\",\n                            params: {\n                                type: \"ERC20\", options: {\n                                    address: dublrAddr, symbol: \"DUBLR\", decimals: 18,\n                                    image: \"https://raw.githubusercontent.com/dublr/dublr/main/icon.svg\" }\n                            }\n                        })) {\n                            // console.log(\"DUBLR token added to MetaMask\");\n                        } else {\n                            console.log(\"DUBLR token could not be added to MetaMask\");\n                        }\n                    } catch (error) {\n                        console.log(error);\n                    }\n                }\n            } else {\n                onboardText.innerText = \"Connect to MetaMask wallet\";\n                onboardButton.disabled = false;\n                onboardButton.onclick = async () => {\n                    // eth_requestAccounts pops up the MetaMask wallet\n                    const accounts = await window.ethereum.request({method: \"eth_requestAccounts\"});\n                    setAccounts(accounts);\n                    await updateButton();\n                };\n            }\n        }\n    };\n    updateButton();\n});\n\n"],"names":[],"version":3,"file":"index.61a698f6.js.map","sourceRoot":"/__parcel_source_root/"}